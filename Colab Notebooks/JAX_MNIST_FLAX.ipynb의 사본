{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"name":"JAX_MNIST_FLAX.ipynb의 사본","provenance":[{"file_id":"1Qc4h3y25jYa0jpb731bR84T_r4sFDpbT","timestamp":1660797245328},{"file_id":"1zehG3-PHNMXBQ8pNAlU9VSC93HkfE2jz","timestamp":1660621061408}],"collapsed_sections":[]},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"accelerator":"GPU","gpuClass":"standard","widgets":{"application/vnd.jupyter.widget-state+json":{"9e0ddce318d54da4b572327b36290eaf":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_e23fb568fd9c4bdb96547ae211917085","IPY_MODEL_95fff65111e244578d8c50900988a772","IPY_MODEL_f568ca20be494cfa9078a09f809112f9"],"layout":"IPY_MODEL_4854cacc95d34e52a980e8ba9ce24dd0"}},"e23fb568fd9c4bdb96547ae211917085":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_0c493b15a71743488b0ca7b58377fc40","placeholder":"​","style":"IPY_MODEL_e797bd3287734ff39e01e79e8ce04939","value":"100%"}},"95fff65111e244578d8c50900988a772":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_253a6101d29d4ae78253904269f0a430","max":9912422,"min":0,"orientation":"horizontal","style":"IPY_MODEL_2bbfcc8a1dc3407d8285cb705121aaac","value":9912422}},"f568ca20be494cfa9078a09f809112f9":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_56c2f3275b404d9c8addde7480b7e0a2","placeholder":"​","style":"IPY_MODEL_9fb2e24b25824c2fa03599794c0e89fa","value":" 9912422/9912422 [00:00&lt;00:00, 117161214.02it/s]"}},"4854cacc95d34e52a980e8ba9ce24dd0":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"0c493b15a71743488b0ca7b58377fc40":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e797bd3287734ff39e01e79e8ce04939":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"253a6101d29d4ae78253904269f0a430":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"2bbfcc8a1dc3407d8285cb705121aaac":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"56c2f3275b404d9c8addde7480b7e0a2":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9fb2e24b25824c2fa03599794c0e89fa":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"4a1f1ef26c2a49dba4c1b706801c5826":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_df395f93801f4865be5f1c478ec7f966","IPY_MODEL_a59fc1c8cee94ecfbce4393a4875d318","IPY_MODEL_4ee3c7fad12d46b6a9272f45219e2347"],"layout":"IPY_MODEL_aebc9d7ab1154e8d8b254b809900fdad"}},"df395f93801f4865be5f1c478ec7f966":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_db48a076a1a3428e81287796c43e9bfe","placeholder":"​","style":"IPY_MODEL_ba073e30a11b487aad14724a15eda94d","value":"100%"}},"a59fc1c8cee94ecfbce4393a4875d318":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_119e040da1cc410998d56d53a75976e1","max":28881,"min":0,"orientation":"horizontal","style":"IPY_MODEL_516b6bb5ad554bb8baf73d475df5481d","value":28881}},"4ee3c7fad12d46b6a9272f45219e2347":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_b2845629e52b421a8485f37b0fb50f3b","placeholder":"​","style":"IPY_MODEL_614314598cf84f82a8f3d247e7828e33","value":" 28881/28881 [00:00&lt;00:00, 760835.69it/s]"}},"aebc9d7ab1154e8d8b254b809900fdad":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"db48a076a1a3428e81287796c43e9bfe":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ba073e30a11b487aad14724a15eda94d":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"119e040da1cc410998d56d53a75976e1":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"516b6bb5ad554bb8baf73d475df5481d":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"b2845629e52b421a8485f37b0fb50f3b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"614314598cf84f82a8f3d247e7828e33":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"06831e635c5642648b21efbeb2f83fb9":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_d55d3c73bb5941b0bbdf7f3f3cc0e24c","IPY_MODEL_a03a7e2453b94284a48fb6b2e700d332","IPY_MODEL_7313796e02e84dfa8a6631edea2c73f2"],"layout":"IPY_MODEL_7025b64cad734e2e93755747cb90eb5f"}},"d55d3c73bb5941b0bbdf7f3f3cc0e24c":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_12ac6a19913845b7ae0fc79e88ec70ec","placeholder":"​","style":"IPY_MODEL_68db69ec521443c5a88f0a737132e1a3","value":"100%"}},"a03a7e2453b94284a48fb6b2e700d332":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_15cfb12edbe54668862a1bc70124cf1e","max":1648877,"min":0,"orientation":"horizontal","style":"IPY_MODEL_ac54fa8b35b342e1905d3a5d23aec90b","value":1648877}},"7313796e02e84dfa8a6631edea2c73f2":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_42b8d71a6bd34c9c8fd59503930f19e6","placeholder":"​","style":"IPY_MODEL_9de40ab68fd34ca7aab613fd043de3e9","value":" 1648877/1648877 [00:00&lt;00:00, 41697665.45it/s]"}},"7025b64cad734e2e93755747cb90eb5f":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"12ac6a19913845b7ae0fc79e88ec70ec":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"68db69ec521443c5a88f0a737132e1a3":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"15cfb12edbe54668862a1bc70124cf1e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ac54fa8b35b342e1905d3a5d23aec90b":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"42b8d71a6bd34c9c8fd59503930f19e6":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9de40ab68fd34ca7aab613fd043de3e9":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"82ac9e7294114782befa3ad75ae2e623":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_f740da09081c40e5ab7d2f820a9ea004","IPY_MODEL_2ebdec5210b64dd6b81e20c374d0f791","IPY_MODEL_9ce19c87786543198c67bc814106556f"],"layout":"IPY_MODEL_295e1bd2681e48c6b0589bb3e79f7000"}},"f740da09081c40e5ab7d2f820a9ea004":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_669465b44685475eb9036575c7fc7f7b","placeholder":"​","style":"IPY_MODEL_a3eeb4bee21e45faa65d7a24788e38f2","value":"100%"}},"2ebdec5210b64dd6b81e20c374d0f791":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_a9019163e6a0425daf0953d8a80b4830","max":4542,"min":0,"orientation":"horizontal","style":"IPY_MODEL_fc48f72734f344ff9352297da2ff2759","value":4542}},"9ce19c87786543198c67bc814106556f":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e30dd5153f534e1d8dc539ce50152981","placeholder":"​","style":"IPY_MODEL_3accf1c050084966ac06adf3d31f9322","value":" 4542/4542 [00:00&lt;00:00, 149344.46it/s]"}},"295e1bd2681e48c6b0589bb3e79f7000":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"669465b44685475eb9036575c7fc7f7b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a3eeb4bee21e45faa65d7a24788e38f2":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"a9019163e6a0425daf0953d8a80b4830":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"fc48f72734f344ff9352297da2ff2759":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"e30dd5153f534e1d8dc539ce50152981":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"3accf1c050084966ac06adf3d31f9322":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"markdown","source":["산업수학 기반 데이터 분석 프로그램\n","\n","김병천 (wizardbc@gmail.com)<br>\n","인하대학교 응용수학연구소 / 스마트소셜 AI 연구소\n","\n","2022년 8월 18일 (목)<br>\n","더케이호텔 서울, 금강A홀\n","\n","# Neural Network from Scratch (FLAX)\n","\n","* 런타임 > 런타임 유형 변경 > 하드웨어 가속기 > GPU\n","\n","```\n","Devices: [GpuDevice(id=0, process_index=0)]\n","```\n","\n","* Input: $x$ (28x28=784, flatten)\n","* Label: $y$ (10, one-hot encoding)\n","* Parameters: $\\theta$\n","* Model: $f(x;\\theta)$\n","* Goal: find $\\theta$ such that $f(x;\\theta) \\approx y$\n","* How: stochastic gradient descent\n","\n"],"metadata":{"id":"kYGApMo-f1Cz"}},{"cell_type":"code","execution_count":2,"metadata":{"id":"K6Vit3x3fxAP","executionInfo":{"status":"ok","timestamp":1660797305208,"user_tz":-540,"elapsed":4,"user":{"displayName":"김현태","userId":"03086644637186436559"}},"outputId":"e3568099-3445-48c8-97c7-45a257b2ef15","colab":{"base_uri":"https://localhost:8080/"}},"outputs":[{"output_type":"stream","name":"stdout","text":["Devices: [GpuDevice(id=0, process_index=0)]\n"]}],"source":["# For some low-memmory GPUs.\n","# %env XLA_PYTHON_CLIENT_PREALLOCATE=false\n","\n","import jax\n","import jax.numpy as jnp\n","from jax import grad, jit, vmap\n","from jax import random\n","\n","import numpy as np\n","from torch.utils.data import DataLoader\n","from torchvision.datasets.mnist import MNIST\n","\n","from functools import partial\n","import time\n","import matplotlib.pyplot as plt\n","\n","## Flax (NN in JAX)\n","try:\n","    import flax\n","except ModuleNotFoundError: # Install flax if missing\n","    !pip install --quiet flax\n","    import flax\n","from flax import linen as nn\n","\n","## Optax (Optimizers in JAX)\n","try:\n","    import optax\n","except ModuleNotFoundError: # Install optax if missing\n","    !pip install --quiet optax\n","    import optax\n","\n","# Seeding for random operations\n","prng_key = random.PRNGKey(42)\n","\n","print(\"Devices:\", jax.devices())"]},{"cell_type":"markdown","source":["## MNIST dataset (28x28)"],"metadata":{"id":"0u2EbygjhfQ2"}},{"cell_type":"code","source":["train_set = MNIST(root='./datasets', train=True, download=True, transform=lambda x: np.ravel(np.array(x, dtype=jnp.float32)))\n","test_set = MNIST(root='./datasets', train=False, download=True, transform=lambda x: np.ravel(np.array(x, dtype=jnp.float32)))\n","\n","len(train_set), len(test_set)"],"metadata":{"id":"98ipQLo4gPpr","colab":{"base_uri":"https://localhost:8080/","height":454,"referenced_widgets":["9e0ddce318d54da4b572327b36290eaf","e23fb568fd9c4bdb96547ae211917085","95fff65111e244578d8c50900988a772","f568ca20be494cfa9078a09f809112f9","4854cacc95d34e52a980e8ba9ce24dd0","0c493b15a71743488b0ca7b58377fc40","e797bd3287734ff39e01e79e8ce04939","253a6101d29d4ae78253904269f0a430","2bbfcc8a1dc3407d8285cb705121aaac","56c2f3275b404d9c8addde7480b7e0a2","9fb2e24b25824c2fa03599794c0e89fa","4a1f1ef26c2a49dba4c1b706801c5826","df395f93801f4865be5f1c478ec7f966","a59fc1c8cee94ecfbce4393a4875d318","4ee3c7fad12d46b6a9272f45219e2347","aebc9d7ab1154e8d8b254b809900fdad","db48a076a1a3428e81287796c43e9bfe","ba073e30a11b487aad14724a15eda94d","119e040da1cc410998d56d53a75976e1","516b6bb5ad554bb8baf73d475df5481d","b2845629e52b421a8485f37b0fb50f3b","614314598cf84f82a8f3d247e7828e33","06831e635c5642648b21efbeb2f83fb9","d55d3c73bb5941b0bbdf7f3f3cc0e24c","a03a7e2453b94284a48fb6b2e700d332","7313796e02e84dfa8a6631edea2c73f2","7025b64cad734e2e93755747cb90eb5f","12ac6a19913845b7ae0fc79e88ec70ec","68db69ec521443c5a88f0a737132e1a3","15cfb12edbe54668862a1bc70124cf1e","ac54fa8b35b342e1905d3a5d23aec90b","42b8d71a6bd34c9c8fd59503930f19e6","9de40ab68fd34ca7aab613fd043de3e9","82ac9e7294114782befa3ad75ae2e623","f740da09081c40e5ab7d2f820a9ea004","2ebdec5210b64dd6b81e20c374d0f791","9ce19c87786543198c67bc814106556f","295e1bd2681e48c6b0589bb3e79f7000","669465b44685475eb9036575c7fc7f7b","a3eeb4bee21e45faa65d7a24788e38f2","a9019163e6a0425daf0953d8a80b4830","fc48f72734f344ff9352297da2ff2759","e30dd5153f534e1d8dc539ce50152981","3accf1c050084966ac06adf3d31f9322"]},"executionInfo":{"status":"ok","timestamp":1660797310331,"user_tz":-540,"elapsed":824,"user":{"displayName":"김현태","userId":"03086644637186436559"}},"outputId":"b0c4dc12-2256-40ae-c500-12f410a30e40"},"execution_count":3,"outputs":[{"output_type":"stream","name":"stdout","text":["Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz\n","Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz to ./datasets/MNIST/raw/train-images-idx3-ubyte.gz\n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/9912422 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"9e0ddce318d54da4b572327b36290eaf"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["Extracting ./datasets/MNIST/raw/train-images-idx3-ubyte.gz to ./datasets/MNIST/raw\n","\n","Downloading http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz\n","Downloading http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz to ./datasets/MNIST/raw/train-labels-idx1-ubyte.gz\n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/28881 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"4a1f1ef26c2a49dba4c1b706801c5826"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["Extracting ./datasets/MNIST/raw/train-labels-idx1-ubyte.gz to ./datasets/MNIST/raw\n","\n","Downloading http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz\n","Downloading http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz to ./datasets/MNIST/raw/t10k-images-idx3-ubyte.gz\n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/1648877 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"06831e635c5642648b21efbeb2f83fb9"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["Extracting ./datasets/MNIST/raw/t10k-images-idx3-ubyte.gz to ./datasets/MNIST/raw\n","\n","Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz\n","Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz to ./datasets/MNIST/raw/t10k-labels-idx1-ubyte.gz\n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/4542 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"82ac9e7294114782befa3ad75ae2e623"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["Extracting ./datasets/MNIST/raw/t10k-labels-idx1-ubyte.gz to ./datasets/MNIST/raw\n","\n"]},{"output_type":"execute_result","data":{"text/plain":["(60000, 10000)"]},"metadata":{},"execution_count":3}]},{"cell_type":"code","source":["plt.style.use('dark_background')\n","\n","for i in range(6):\n","    ax = plt.subplot(2, 3, i+1, )\n","    elt = test_set[i]\n","    ax.set_title(f'Test {i}, label: {elt[1]}')\n","    ax.imshow(elt[0].reshape(28,28), cmap='gray')\n","plt.tight_layout()\n","plt.show()"],"metadata":{"id":"wsbVfuRMhlkq","colab":{"base_uri":"https://localhost:8080/","height":298},"executionInfo":{"status":"ok","timestamp":1660797318629,"user_tz":-540,"elapsed":1819,"user":{"displayName":"김현태","userId":"03086644637186436559"}},"outputId":"e3354c3d-5caf-4311-efc3-853821979175"},"execution_count":4,"outputs":[{"output_type":"display_data","data":{"text/plain":["<Figure size 432x288 with 6 Axes>"],"image/png":"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\n"},"metadata":{}}]},{"cell_type":"markdown","source":["## Model"],"metadata":{"id":"9lIh8cvwhoxR"}},{"cell_type":"code","source":["layer_sizes = [784, 512, 512, 10]\n","step_size = 0.001\n","num_epochs = 8\n","batch_size = 128\n","n_targets = 10\n","\n","train_loader = DataLoader(train_set, collate_fn=lambda b: tuple([np.stack(s) for s in zip(*b)]), shuffle=True, batch_size=batch_size)\n","\n","train_data = jnp.array(train_set.data, dtype=jnp.float32).reshape(-1, 28*28)\n","train_targets = jax.nn.one_hot(jnp.array(train_set.targets), n_targets)\n","test_data = jnp.array(test_set.data, dtype=jnp.float32).reshape(-1, 28*28)\n","test_targets = jax.nn.one_hot(jnp.array(test_set.targets), n_targets)"],"metadata":{"id":"GYWeRoIChoYm","executionInfo":{"status":"ok","timestamp":1660797323730,"user_tz":-540,"elapsed":656,"user":{"displayName":"김현태","userId":"03086644637186436559"}}},"execution_count":5,"outputs":[]},{"cell_type":"code","source":["for i, (x, y) in enumerate(train_loader):\n","    print(i, x.shape, y.shape)\n","    break"],"metadata":{"id":"4iv1PX7ZjiMl","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1660797325001,"user_tz":-540,"elapsed":4,"user":{"displayName":"김현태","userId":"03086644637186436559"}},"outputId":"e6a66227-6fc6-4ae0-a782-403d38f1d5c2"},"execution_count":6,"outputs":[{"output_type":"stream","name":"stdout","text":["0 (128, 784) (128,)\n"]}]},{"cell_type":"markdown","source":["* LogSumExp (LSE)\n","$$LSE(x_1,\\ldots,x_n) = \\log(\\exp(x_1)+\\cdots+\\exp(x_n)).$$\n","\n","* Softmax\n","<br>\n","Note that for any $(x_1,\\ldots,x_n)\\in\\mathbb R^n$, $$\\sum_{i=1}^n p_i = \\sum_{i=1}^n \\frac{\\exp(x_i)}{\\exp(x_1)+\\cdots+\\exp(x_n)} = 1.$$\n","Given $1\\leq m\\leq n$, if $(x_1,\\ldots,x_n)$ is $x_i\\ll 0$ for all $i$ but $x_m\\gg 0$,\n","then we have $$p_m=\\frac{\\exp(x_m)}{\\exp(x_1)+\\cdots+\\exp(x_n)} \\approx 1,$$ which implies\n","$$\\log(p_m)=x_m - LSE(x_1,\\ldots,x_n) \\approx 0.$$\n","\n","* Cross-Entropy $$-\\sum_{i=1}^n t_i\\log(p_i)$$\n","where $t_i$ is the truth label for $i$-th class."],"metadata":{"id":"smPuCLcEsS60"}},{"cell_type":"code","source":["from flax import linen as nn\n","from jax.scipy.special import logsumexp\n","from typing import Any, Callable, Sequence\n","\n","class SimpleDense(nn.Module):\n","  features: int\n","\n","  @nn.compact\n","  def __call__(self, x):\n","    kernel = self.param('kernel',                             # parameter name\n","                        jax.nn.initializers.xavier_normal(),  # initializer function\n","                        (x.shape[-1], self.features))         # shape\n","    bias = self.param('bias',\n","                      jax.nn.initializers.zeros,\n","                      (self.features,))\n","    return x @ kernel + bias\n","\n","def relu(x):\n","  return jnp.maximum(0, x)\n","\n","class SimpleMLP(nn.Module):\n","  features: Sequence[int]\n","\n","  @nn.compact\n","  def __call__(self, x):\n","    for i, feat in enumerate(self.features):\n","      x = SimpleDense(feat, name=f'dense_{i}')(x)\n","      if i < len(self.features) - 1:\n","        x = relu(x)\n","    return x - logsumexp(x, axis=-1, keepdims=True)"],"metadata":{"id":"VHpUDucTvX6K","executionInfo":{"status":"ok","timestamp":1660797498754,"user_tz":-540,"elapsed":894,"user":{"displayName":"김현태","userId":"03086644637186436559"}}},"execution_count":7,"outputs":[]},{"cell_type":"code","source":["prng_key, key1, key2 = random.split(prng_key, 3)\n","x = random.uniform(key1, (batch_size, 784))\n","\n","model = SimpleMLP(features=layer_sizes[1:])\n","params = model.init(key2, x)\n","y = model.apply(params, x)\n","\n","print('initialized parameter shapes:\\n', jax.tree_util.tree_map(jnp.shape, params))\n","print('output:\\n', y.shape)"],"metadata":{"id":"6WIFO44zvX3B","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1660797791344,"user_tz":-540,"elapsed":4,"user":{"displayName":"김현태","userId":"03086644637186436559"}},"outputId":"23732c1a-bdc1-4616-a555-3d72c0f961e9"},"execution_count":10,"outputs":[{"output_type":"stream","name":"stdout","text":["initialized parameter shapes:\n"," FrozenDict({\n","    params: {\n","        dense_0: {\n","            bias: (512,),\n","            kernel: (784, 512),\n","        },\n","        dense_1: {\n","            bias: (512,),\n","            kernel: (512, 512),\n","        },\n","        dense_2: {\n","            bias: (10,),\n","            kernel: (512, 10),\n","        },\n","    },\n","})\n","output:\n"," (128, 10)\n"]}]},{"cell_type":"code","source":["@jit\n","def loss_fn(params, images, targets):\n","  preds = model.apply(params, images)\n","  return -jnp.mean(targets * preds)\n","\n","@jit\n","def accuracy(params, images, targets):\n","  target_class = jnp.argmax(targets, axis=1)\n","  predicted_class = jnp.argmax(model.apply(params, images), axis=1)\n","  return jnp.mean(predicted_class == target_class)"],"metadata":{"id":"x7oE1SrjvX0q","executionInfo":{"status":"ok","timestamp":1660797802187,"user_tz":-540,"elapsed":624,"user":{"displayName":"김현태","userId":"03086644637186436559"}}},"execution_count":11,"outputs":[]},{"cell_type":"code","source":["optimizer = optax.adam(learning_rate=step_size)\n","opt_state = optimizer.init(params)\n","\n","@jit\n","def step(params, opt_state, x, y):\n","    loss_value, grads = jax.value_and_grad(loss_fn)(params, x, y)\n","    updates, opt_state = optimizer.update(grads, opt_state, params)\n","    params = optax.apply_updates(params, updates)\n","    return params, opt_state, loss_value"],"metadata":{"id":"Wf2fUVn6wSrH","executionInfo":{"status":"ok","timestamp":1660797815633,"user_tz":-540,"elapsed":589,"user":{"displayName":"김현태","userId":"03086644637186436559"}}},"execution_count":12,"outputs":[]},{"cell_type":"code","source":["train_loss = loss_fn(params, train_data, train_targets)\n","train_acc = accuracy(params, train_data, train_targets)\n","test_acc = accuracy(params, test_data, test_targets)\n","\n","print(f\"Loss {train_loss}\")\n","print(f\"Training set accuracy {train_acc}\")\n","print(f\"Test set accuracy {test_acc}\")"],"metadata":{"id":"l52aB8lSt5sp","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1660797824246,"user_tz":-540,"elapsed":5839,"user":{"displayName":"김현태","userId":"03086644637186436559"}},"outputId":"a88d9fc0-1f54-4d8b-d0bd-6cc62042b990"},"execution_count":13,"outputs":[{"output_type":"stream","name":"stdout","text":["Loss 10.335311889648438\n","Training set accuracy 0.08223333209753036\n","Test set accuracy 0.08720000088214874\n"]}]},{"cell_type":"code","source":["for epoch in range(num_epochs):\n","  start_time = time.time()\n","  for x, y in train_loader:\n","    y = jax.nn.one_hot(y, 10)\n","    params, opt_state, loss_value = step(params, opt_state, x, y)\n","  epoch_time = time.time() - start_time\n","\n","  train_loss = loss_fn(params, train_data, train_targets)\n","  train_acc = accuracy(params, train_data, train_targets)\n","  test_acc = accuracy(params, test_data, test_targets)\n","  print(f\"Epoch {epoch} in {epoch_time:0.2f} sec, loss {train_loss:.4f}\")\n","  print(f\"\\tTraining set accuracy {train_acc:.4f}\")\n","  print(f\"\\tTest set accuracy {test_acc:.4f}\")"],"metadata":{"id":"a32M0xa9uCD5","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1660797846077,"user_tz":-540,"elapsed":21839,"user":{"displayName":"김현태","userId":"03086644637186436559"}},"outputId":"6d0c7287-84a3-4d1a-e621-7a8dbc326971"},"execution_count":14,"outputs":[{"output_type":"stream","name":"stdout","text":["Epoch 0 in 4.44 sec, loss 0.0338\n","\tTraining set accuracy 0.9533\n","\tTest set accuracy 0.9379\n","Epoch 1 in 2.51 sec, loss 0.0173\n","\tTraining set accuracy 0.9695\n","\tTest set accuracy 0.9534\n","Epoch 2 in 2.49 sec, loss 0.0143\n","\tTraining set accuracy 0.9724\n","\tTest set accuracy 0.9585\n","Epoch 3 in 2.51 sec, loss 0.0128\n","\tTraining set accuracy 0.9740\n","\tTest set accuracy 0.9555\n","Epoch 4 in 2.61 sec, loss 0.0099\n","\tTraining set accuracy 0.9799\n","\tTest set accuracy 0.9629\n","Epoch 5 in 2.55 sec, loss 0.0115\n","\tTraining set accuracy 0.9738\n","\tTest set accuracy 0.9572\n","Epoch 6 in 2.52 sec, loss 0.0058\n","\tTraining set accuracy 0.9860\n","\tTest set accuracy 0.9714\n","Epoch 7 in 2.54 sec, loss 0.0067\n","\tTraining set accuracy 0.9839\n","\tTest set accuracy 0.9673\n"]}]},{"cell_type":"markdown","source":["## Using FLAX\n","\n","[google/flax](https://github.com/google/flax)"],"metadata":{"id":"qMtRHi4ByT1Q"}},{"cell_type":"code","source":["from flax import linen as nn\n","from jax.scipy.special import logsumexp\n","from typing import Sequence\n","\n","class MLP(nn.Module):\n","  features: Sequence[int]\n","\n","  @nn.compact\n","  def __call__(self, x):\n","    for i, feat in enumerate(self.features):\n","      x = nn.Dense(feat, name=f'dense_{i}')(x)\n","      if i < len(self.features) - 1:\n","        x = jax.nn.relu(x)\n","    return x - logsumexp(x, axis=-1, keepdims=True)"],"metadata":{"id":"mA2crFeDyXha"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["prng_key, key1, key2 = random.split(prng_key, 3)\n","x = random.uniform(key1, (batch_size, 784))\n","\n","model = SimpleMLP(features=layer_sizes[1:])\n","params = model.init(key2, x)\n","y = model.apply(params, x)\n","\n","print('initialized parameter shapes:\\n', jax.tree_util.tree_map(jnp.shape, params))\n","print('output:\\n', y.shape)"],"metadata":{"id":"R-zWgRXTzFwk"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["@jit\n","def loss_fn(params, images, targets):\n","  preds = model.apply(params, images)\n","  return -jnp.mean(targets * preds)\n","\n","@jit\n","def accuracy(params, images, targets):\n","  target_class = jnp.argmax(targets, axis=1)\n","  predicted_class = jnp.argmax(model.apply(params, images), axis=1)\n","  return jnp.mean(predicted_class == target_class)\n","\n","@jit\n","def step(params, opt_state, x, y):\n","    loss_value, grads = jax.value_and_grad(loss_fn)(params, x, y)\n","    updates, opt_state = optimizer.update(grads, opt_state, params)\n","    params = optax.apply_updates(params, updates)\n","    return params, opt_state, loss_value\n","\n","train_loss = loss_fn(params, train_data, train_targets)\n","train_acc = accuracy(params, train_data, train_targets)\n","test_acc = accuracy(params, test_data, test_targets)\n","print(f\"Loss {train_loss}\")\n","print(f\"Training set accuracy {train_acc}\")\n","print(f\"Test set accuracy {test_acc}\")"],"metadata":{"id":"5R3YtkgJzM0J"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["optimizer = optax.adam(learning_rate=step_size)\n","opt_state = optimizer.init(params)\n","\n","for epoch in range(num_epochs):\n","  start_time = time.time()\n","  for x, y in train_loader:\n","    y = jax.nn.one_hot(y, 10)\n","    params, opt_state, loss_value = step(params, opt_state, x, y)\n","  epoch_time = time.time() - start_time\n","\n","  train_loss = loss_fn(params, train_data, train_targets)\n","  train_acc = accuracy(params, train_data, train_targets)\n","  test_acc = accuracy(params, test_data, test_targets)\n","  print(f\"Epoch {epoch} in {epoch_time:0.2f} sec, loss {train_loss:.4f}\")\n","  print(f\"\\tTraining set accuracy {train_acc:.4f}\")\n","  print(f\"\\tTest set accuracy {test_acc:.4f}\")"],"metadata":{"id":"5qTYtBZ3zai2"},"execution_count":null,"outputs":[]}]}